<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Introduction to shapeshiftr • shapeshiftr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to shapeshiftr">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">shapeshiftr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Introduction.html">Introduction to shapeshiftr</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Introduction to shapeshiftr</h1>
            
      

      <div class="d-none name"><code>Introduction.Rmd</code></div>
    </div>

    
    
<style>
    img {
        border: 0;
    }
</style>
<div class="section level2">
<h2 id="background">Background<a class="anchor" aria-label="anchor" href="#background"></a>
</h2>
<p>This package was motivated by working with an animal telemetry
dataset that spanned decades. We wanted to measure the link between
spatial distribution and cohesion in group, but were limited to only
location data. After some tinkering and reading the literature, we
discovered that measuring the distances between pairs of individuals
offered a promising way to understand this relationship.</p>
<p>The degree of social cohesion across a group depends on the distance
between individuals, because greater separation reduces their ability to
coordinate their actions.Their spacing reflects a balance between
attraction (safety in numbers or finding mates) and repulsion (avoiding
competition). When population size or habitat conditions change, that
balance can shift—leading to changes in how the group is spaced out, and
even in the shape of their overall range (like shrinking, stretching, or
splitting apart).</p>
<p><img src="../reference/figures/iidicons.png" width="30%" style="display: block; margin: auto;"></p>
<p>Determining the range and spatial density of individuals fully
requires extensive sampling. Our method adds to the existing toolkit of
spatial analysis by offering summary statistics that require less
sampling to describe key features of a population’s range and detect
changes over time in spatial use. We use two different measures of the
coefficient of variation (CV) in IID: individual-level and
population-level. Both provide a scale-free measure that stays constant
if density changes without changing the spatial distribution, or if the
range changes symmetrically as the population shifts. However, changes
in range shape and/or splitting into subpopulations alter these two CV
measures, and their ratio, in distinct ways:</p>
<p><img src="../reference/figures/cvsims.png" width="70%" style="display: block; margin: auto;"></p>
<p>For the full description of the method and its application, see: Love
&amp; Otto (2025). <em>Spatial Signatures of Population Cohesion</em>.
Methods in Ecology and Evolution. <a href="https://doi.org/" class="external-link uri">https://doi.org/</a></p>
</div>
<div class="section level2">
<h2 id="cv-functions">CV functions<a class="anchor" aria-label="anchor" href="#cv-functions"></a>
</h2>
<p>This package has two streams of functions depending on the type of
input.</p>
<div class="section level3">
<h3 id="stream-1-non-sf-data">Stream 1: non-sf data<a class="anchor" aria-label="anchor" href="#stream-1-non-sf-data"></a>
</h3>
<p>If you have Cartesian coordinates in separate columns or vectors
whose distances are not substantially far enough apart to account for
the curvature of the earth, use <code><a href="../reference/cvpop.html">cvpop()</a></code>,
<code><a href="../reference/cvind.html">cvind()</a></code> and <code>cvatio()</code>. These functions produce
a numeric value, or if used within dplyr verbs, a column, where each row
contains the CV of IID for a given sampling unit (time, season,
site).</p>
<ul>
<li>
<code>cvpop</code>: calculates the population-level CV of
inter-individual distances (CV of all distances between all pairs of
individuals)</li>
<li>
<code>cvind</code>: calculates the individual-level CV of
inter-individual distances (CV of the average inter-individual distance
across all individuals)</li>
<li>
<code>cvratio</code>: calculates the ratio of individual-level CV to
population-level CV</li>
</ul>
<p>Consider, as an example, a population with 10 individuals that has
been sampled five times in one day for two years. The dataset includes
the location (“x”, “y”), the year sampled (“year”), the identification
of the individual sampled (“id”), and for illustrative purposes, a
column containing data but not relevant to these functions
(“random”).</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://nicolalove.github.io/shapeshiftr/">shapeshiftr</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">split_population</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##          x        y year random id</span></span>
<span><span class="co">## 1 49.14853 71.34843    1   char  1</span></span>
<span><span class="co">## 2 59.24515 31.67412    1   char  2</span></span>
<span><span class="co">## 3 47.17220 66.03379    1   char  3</span></span>
<span><span class="co">## 4 57.60253 33.80525    1   char  4</span></span>
<span><span class="co">## 5 37.18787 31.27433    1   char  5</span></span>
<span><span class="co">## 6 67.75630 48.38934    1   char  6</span></span></code></pre>
<p>The data is spread across multiple years, we will use our CV
functions in a pipe where the dataframe is grouped by year.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sp</span> <span class="op">&lt;-</span> <span class="va">split_population</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">group_by</span><span class="op">(</span><span class="va">year</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>                      <span class="fu">summarise</span><span class="op">(</span>pop <span class="op">=</span> <span class="fu"><a href="../reference/cvpop.html">cvpop</a></span><span class="op">(</span><span class="fu">across</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">x</span>,<span class="va">y</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, </span>
<span>                                ind <span class="op">=</span> <span class="fu"><a href="../reference/cvind.html">cvind</a></span><span class="op">(</span><span class="fu">across</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">x</span>,<span class="va">y</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, </span>
<span>                                ratio <span class="op">=</span> <span class="fu"><a href="../reference/cvratio.html">cvratio</a></span><span class="op">(</span><span class="fu">across</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">x</span>,<span class="va">y</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="va">sp</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 2 × 4</span></span></span>
<span><span class="co">##    year   pop   ind ratio</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span>     1 0.524 0.270 0.514</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span>     2 0.626 0.147 0.235</span></span></code></pre>
<p>From year 1 to year 2, the population-level CV has increased while
the individual-level CV and the ratio has decreased, which is indicative
of population fragmentation. Let’s visualize the data to check:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="va">split_population</span>, <span class="fu">aes</span><span class="op">(</span><span class="va">x</span>,<span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"year"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">coord_equal</span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">100</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="Introduction_files/figure-html/visualize%20non-sf%20data-1.png" width="2187.5" style="display: block; margin: auto;"></p>
<p>We can see that the population has split from into two subpopulations
from year 1 to year 2.</p>
</div>
<div class="section level3">
<h3 id="stream-2-sf-data">Stream 2: <code>sf</code> data<a class="anchor" aria-label="anchor" href="#stream-2-sf-data"></a>
</h3>
<p>If you have a dataframe where the coordinates are stored within a
geometry column (an <code>sf</code> dataframe), use
<code><a href="../reference/iidist.html">iidist()</a></code> and <code><a href="../reference/cvmetrics_sf.html">cvmetrics_sf()</a></code>.</p>
<ul>
<li>
<code>iidist</code>: measures the inter-individual distance between
every pair of individuals within a given sampling unit (e.g., day,
season, patch). This function takes an <code>sf</code> dataframe as
input and returns a dataframe that retains the user-defined sampling
unit columns (as specified in <code>nest_by</code>), along with two
bookkeeping columns identifying each unique pair and a column of the
calculated distance between them.</li>
<li>
<code>cvmetrics_sf</code>: measures the population- and
individual-level CV of IID and their ratio within a given sampling unit.
This function takes a dataframe containing inter-individual distances
for each unique pair within a given sampling unit and returns a
dataframe with the population-level CV, individual-level CV, their
ratio, and the sampling unit columns.</li>
</ul>
<p>Consider again a population with 10 individuals that has been sampled
five times in one day for two years, where the dataframe is a
<code>sf</code> object. The dataset includes the year sampled (“year”),
a column containing data but not relevant to these functions (“random”),
the identification of the individual sampled (“id”), and the location
coordinates stored in a geometry column.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">asym_split_sf</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Simple feature collection with 6 features and 3 fields</span></span>
<span><span class="co">## Geometry type: POINT</span></span>
<span><span class="co">## Dimension:     XY</span></span>
<span><span class="co">## Bounding box:  xmin: 29.31003 ymin: -22.40374 xmax: 29.35845 ymax: -22.33439</span></span>
<span><span class="co">## Geodetic CRS:  WGS 84</span></span>
<span><span class="co">##   year random id                   geometry</span></span>
<span><span class="co">## 1    1   char  1 POINT (29.31003 -22.35791)</span></span>
<span><span class="co">## 2    1   char  2 POINT (29.35845 -22.40374)</span></span>
<span><span class="co">## 3    1   char  3 POINT (29.31591 -22.37886)</span></span>
<span><span class="co">## 4    1   char  4   POINT (29.323 -22.33439)</span></span>
<span><span class="co">## 5    1   char  5 POINT (29.31635 -22.35588)</span></span>
<span><span class="co">## 6    1   char  6  POINT (29.3342 -22.35854)</span></span></code></pre>
<p>We will first use <code><a href="../reference/iidist.html">iidist()</a></code> to calculate the IID for each
unique pair-year, and then use the output as input for
<code><a href="../reference/cvmetrics_sf.html">cvmetrics_sf()</a></code>.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">distances</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/iidist.html">iidist</a></span><span class="op">(</span><span class="va">asym_split_sf</span>, nest_by <span class="op">=</span> <span class="st">"year"</span>, idcol <span class="op">=</span> <span class="st">"id"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">distances</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 6 × 4</span></span></span>
<span><span class="co">##    year ID1   ID2   iidist</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>    <span style="color: #949494;">[m]</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span>     1 2     1      <span style="text-decoration: underline;">7</span>123.</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span>     1 3     1      <span style="text-decoration: underline;">2</span>406.</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span>     1 4     1      <span style="text-decoration: underline;">2</span>936.</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span>     1 5     1       688.</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span>     1 6     1      <span style="text-decoration: underline;">2</span>486.</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span>     1 7     1      <span style="text-decoration: underline;">6</span>041.</span></span></code></pre>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cvs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cvmetrics_sf.html">cvmetrics_sf</a></span><span class="op">(</span><span class="va">distances</span>, distcol <span class="op">=</span> <span class="st">"iidist"</span>, idcol <span class="op">=</span> <span class="st">"ID1"</span>, grp_by <span class="op">=</span> <span class="st">"year"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Joining with `by = join_by(year)`</span></span></code></pre>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">cvs</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 2 × 4</span></span></span>
<span><span class="co">##    year cvpop cvind ratio</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span>     1 0.480 0.218 0.455</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span>     2 0.672 0.118 0.175</span></span></code></pre>
<p>From year 1 to year 2, the population-level CV has increased while
the individual-level CV and the ratio has decreased, which is indicative
of population fragmentation. Let’s visualize the data to check:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="va">asym_split_sf</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"year"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">29.15</span>, <span class="fl">29.45</span><span class="op">)</span>,crs <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_crs</a></span><span class="op">(</span><span class="fl">4326</span><span class="op">)</span>,datum <span class="op">=</span> <span class="cn">NA</span>, expand <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">scale_x_continuous</span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/pretty_breaks.html" class="external-link">pretty_breaks</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="Introduction_files/figure-html/visualize%20sf%20data-1.png" width="2187.5" style="display: block; margin: auto;"></p>
<p>We can see that the population has asymmetrically split from year one
to year two, where a small proportion of the population has moved north,
whereas the majority of the population moved slightly south.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Nicola Love, Sally Otto.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
